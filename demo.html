<!DOCTYPE html>
<html lang="zh-Hans">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>防抖与节流的应用</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .container {
      margin: 0 24px;
      padding: 0 24px;
      width: 368px;
    }

    form {
      margin: 16px 0;
      display: flex;
      flex-direction: column;
    }

    form>* {
      margin: 4px;
    }
  </style>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/siimple@3.3.1/dist/siimple.min.css">
</head>

<body>

  <div class="container">
    <h1>防抖函数的应用</h1>
    <p>Tips: 观察输出区域的更新频率</p>
    <form>
      <label class="siimple-label" for="undebounce">无防抖，每次输入都会立即更新结果</label>
      <input class="siimple-input" id="undebounce" type="text" placeholder="无防抖函数" oninput="input(event)"
        onblur="clean(event)" />
    </form>
    <form>
      <label class="siimple-label" for="debounce">有防抖，在停止输入一秒后更新结果</label>
      <input class="siimple-input" id="debounce" type="text" placeholder="有防抖函数" oninput="inputWithDebounce(event)"
        onblur="clean(event)" />
    </form>
    <form>
      <label class="siimple-label" for="display-debounce">Debounce 结果输出区域</label>
      <input class="siimple-input" id="display-debounce" type="text" placeholder="用户输入内容" disabled />
    </form>
  </div>

  <hr>

  <div class="container">
    <h1>节流函数的用法</h1>
    <p>Tips: 观察输出区域的更新频率</p>
    <form>
      <label class="siimple-label" for="switch">选择 节流 / 非节流 模式</label>
      <select class="siimple-select siimple-select--fluid" onchange="select(this.value)">
        <option value="unselect" selected>未选择模式</option>
        <option value="unthrottle">非节流模式</option>
        <option value="throttle">节流模式</option>
      </select>
    </form>
    <form>
      <label class="siimple-label" for="display-throttle">Throttle 结果输出区域</label>
      <input id="display-throttle" type="text" placeholder="鼠标坐标位置" disabled />
    </form>
  </div>

</body>

<script>
  /**
   * 防抖函数
   *
   * @param {Function} fn 要防抖的函数
   * @param {number} interval 防抖间隔，即多久没有抖动后才执行函数
   */
  function debounce(fn, interval = 300) {
    let timer;
    return args => {
      clearTimeout(timer);
      timer = setTimeout(() => fn(args), interval);
    };
  }

  /**
   * 节流函数
   *
   * @param {Function} fn 要节流的函数
   * @param {number} delay 节流延迟，即有事件触发时，每隔多长时间执行一次函数
   */
  function throttle(fn, delay = 300) {
    let runnable = true;
    return args => {
      if (!runnable) { return; }
      runnable = false;
      setTimeout(() => runnable = true, delay);
      return fn(args);
    };
  }

  document.querySelectorAll('form').forEach(form => form.onsubmit = event => event.preventDefault());

  const clean = event => {
    event.target.value = '';
    document.getElementById('display-debounce').value = '';
  }

  const input = event => document.getElementById('display-debounce').value = event.target.value;
  const mouse = event => document.getElementById('display-throttle').value = `${event.screenX}, ${event.screenY}`;

  const inputWithDebounce = debounce(input, 1000);
  const mouseWithThrottle = throttle(mouse, 1000);

  function select(mode) {
    switch (mode) {
      case 'unthrottle':
        document.body.onmousemove = mouse;
        break;
      case 'throttle':
        document.body.onmousemove = mouseWithThrottle;
        break;
      default:
        document.body.onmousemove = undefined;
        document.getElementById('display-throttle').value = '';
    }
  }

</script>

</html>
